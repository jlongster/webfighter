!function(){"use strict";"undefined"==typeof window.fxpay&&(window.fxpay={});var a=window.fxpay;a.getattr=function(a){for(var b=a.split("."),c=window.fxpay,d="",e=0;e<b.length;e++){if(d&&(d+="."),d+=b[e],!c.hasOwnProperty(b[e]))throw new Error('The module "'+a+'" is not defined on fxpay. First undefined part: "'+d+'"');c=c[b[e]]}return c}}(),function(){"use strict";var a=fxpay.utils={};a.defaults=function(a,b){return a=a||{},Object.keys(b).forEach(function(c){"undefined"==typeof a[c]&&(a[c]=b[c])}),a},a.getSelfOrigin=function(a){if(a||(a=fxpay.getattr("settings")),a.appSelf){if(!a.appSelf.origin)throw new Error("app does not have an origin");return a.appSelf.origin}var b=a.window;return b.location.origin?b.location.origin:b.location.protocol+"//"+b.location.hostname},a.getUrlOrigin=function(a){var b=document.createElement("a");return b.href=a,b.origin||b.protocol+"//"+b.host},a.getCenteredCoordinates=function(a,b){var c=window.screenX+Math.max(0,Math.floor((window.innerWidth-a)/2)),d=window.screenY+Math.max(0,Math.floor((window.innerHeight-b)/2));return[c,d]},a.reCenterWindow=function(b,c,d){var e=fxpay.getattr("settings");c=c||e.winWidth,d=d||e.winHeight;var f=a.getCenteredCoordinates(c,d);try{c+=b.outerWidth-b.innerWidth,d+=b.outerHeight-b.innerHeight,e.log.log("width: ",c,"height:",d),b.resizeTo(c,d),b.moveTo(f[0],f[1])}catch(g){e.log.log("We don't have permission to resize this window")}},a.openWindow=function(b){var c=fxpay.getattr("settings"),d={url:"",title:"FxPay",w:c.winWidth,h:c.winHeight};b=a.defaults(b,d);var e=a.getCenteredCoordinates(b.w,b.h),f="toolbar=no,location=yes,directories=no,menubar=no,scrollbars=yes,resizable=no,copyhistory=no,width="+b.w+",height="+b.h+",top="+e[1]+",left="+e[0],g=c.window.open(b.url,b.title,f);return g||c.log.error("window.open() failed. URL:",b.url),g},a.getAppSelf=function(a){function b(a){if(null===a)throw new Error("cannot store a null appSelf");return c.appSelf=a,a}var c=fxpay.getattr("settings");if(null!==c.appSelf)return a(null,c.appSelf);if(!c.mozApps)return c.log.info("web platform does not define mozApps, cannot get appSelf"),a(null,b(!1));var d=c.mozApps.getSelf();d.onsuccess=function(){var d=this.result;c.log.info("got appSelf from mozApps.getSelf()"),a(null,b(d||!1))},d.onerror=function(){var b=this.error.name;c.log.error("mozApps.getSelf() returned an error",b),a(b,c.appSelf)}}}(),function(){"use strict";var a=fxpay.settings={},b={version:"0.0.14"},c={allowTestReceipts:!1,apiUrlBase:"https://marketplace.firefox.com",apiVersionPrefix:"/api/v1",apiTimeoutMs:null,extraProviderUrls:null,fakeProducts:!1,log:window.console||{debug:function(){},error:function(){},info:function(){},log:function(){},warn:function(){}},receiptCheckSites:["https://receiptcheck.marketplace.firefox.com","https://marketplace.firefox.com"],adapter:null,appSelf:null,alreadyConfigured:!1,payProviderUrls:{"mozilla/payments/pay/v1":"https://marketplace.firefox.com/mozpay/?req={jwt}"},window:window,winWidth:276,winHeight:384,prepareJwtApiUrl:"/webpay/inapp/prepare/",onerror:function(a){throw a},oninit:function(){a.log.info("fxpay version:",a.libVersion),a.log.info("initialization ran successfully")},onrestore:function(b,c){b?a.log.error("error while restoring product:",c.productId,"message:",b):a.log.info("product",c.productId,"was restored from receipt")},localStorage:window.localStorage||null,localStorageKey:"fxpayReceipts",onBrokenWebRT:navigator.mozPay&&-1===navigator.userAgent.indexOf("Mobile"),mozPay:navigator.mozPay||null,mozApps:navigator.mozApps||null,libVersion:b.version};a.configure=function(b,d){if(d=d||{},a.alreadyConfigured||(d.reset=!0),d.reset)for(var e in c)a[e]=c[e];for(var f in b){if("undefined"==typeof a[f])return a.log.error("configure() received an unknown setting:",f),a.onerror("INCORRECT_USAGE");a[f]=b[f]}if(a.extraProviderUrls){a.log.info("adding extra pay provider URLs",a.extraProviderUrls);for(var g in a.extraProviderUrls)a.payProviderUrls[g]=a.extraProviderUrls[g]}a.fakeProducts&&(a.allowTestReceipts=!0);var h=fxpay.getattr("adapter").FxInappAdapter;return a.adapter||(a.log.info("creating default adapter"),a.adapter=new h),a.adapter.configure(a),a.log.info("using adapter:",a.adapter.toString()),a.log.info("(re)configuration completed; fxpay version:",a.libVersion),a.alreadyConfigured=!0,a},a.initialize=function(b){"object"==typeof b&&b?a.configure(b):a.alreadyConfigured||a.configure()}}(),function(){"use strict";function a(a,b){b=b||{},this.baseUrl=a,this.log=d.log,this.timeoutMs=d.apiTimeoutMs||1e4,this.versionPrefix=d.apiVersionPrefix||void 0}function b(a){var b=[];for(var c in a)a.hasOwnProperty(c)&&b.push(encodeURIComponent(c)+"="+encodeURIComponent(a[c]));return b.join("&")}var c=fxpay.api={},d=fxpay.getattr("settings");c.API=a,a.prototype.url=function(a,b){b=b||{},b.versioned="undefined"!=typeof b.versioned?b.versioned:!0;var c=this.baseUrl;return b.versioned&&(c+=this.versionPrefix||""),c+=a},a.prototype.request=function(a,c,e,f,g){g=g||{};var h=e?"application/x-www-form-urlencoded":null;g.contentType=g.contentType||h;var i={Accept:"application/json"};g.contentType&&(i["Content-Type"]=g.contentType),g.headers=g.headers||{};for(var j in i)j in g.headers||(g.headers[j]=i[j]);g.headers["x-fxpay-version"]=d.libVersion;var k,l=this.log,m=this;f||(f=function(a,b){if(a)throw a;l.info("default callback received data:",b)}),k=/^http(s)?:\/\/.*/.test(c)?c:this.url(c);var n=new XMLHttpRequest,o={abort:function(){l.error("xhr abort: path:",c),f("API_REQUEST_ABORTED")},error:function(a){l.error("xhr error: ",a,"path:",c),f("API_REQUEST_ERROR")},load:function(){var a;if("2"!==this.status.toString().slice(0,1)){var b="BAD_API_RESPONSE";return l.error(b,"status:",this.status,"for URL:",k),l.debug(b,"response:",this.responseText),f("BAD_API_RESPONSE")}l.debug("xhr load: GOT",this.responseText);try{a=JSON.parse(this.responseText)}catch(c){var b="BAD_JSON_RESPONSE";return l.error(b,"for URL:",k,"exception",c,"response:",this.responseText),f(b)}f(null,a)},timeout:function(){l.error("xhr request to",k,"timed out after",m.timeoutMs,"ms"),f("API_REQUEST_TIMEOUT")}};for(var p in o)n.addEventListener(p,o[p],!1);l.debug("opening",a,"to",k),n.open(a,k,!0),n.timeout=m.timeoutMs;for(var q in g.headers)n.setRequestHeader(q,g.headers[q]);"application/x-www-form-urlencoded"===g.contentType&&e&&(e=b(e)),n.send(e)},a.prototype.get=function(a,b,c){this.request("GET",a,null,b,c)},a.prototype.del=function(a,b,c){this.request("DELETE",a,null,b,c)},a.prototype.post=function(a,b,c,d){this.request("POST",a,b,c,d)},a.prototype.put=function(a,b,c,d){this.request("PUT",a,b,c,d)}}(),function(){"use strict";var a=fxpay.jwt={},b=fxpay.getattr("settings");a.decode=function(a,c){var d=a.split(".");if(3!==d.length)return b.log.error("JWT does not have 3 segments:",a),c("WRONG_JWT_SEGMENT_COUNT");var e=d[1];e=e.replace("-","+","g").replace("_","/","g");var f;try{f=atob(e)}catch(g){return b.log.error("atob() error:",g.toString(),"when decoding JWT",e),c("INVALID_JWT_DATA")}var h;try{h=JSON.parse(f)}catch(g){return b.log.error("JSON.parse() error:",g.toString(),"when parsing",f),c("INVALID_JWT_DATA")}c(null,h)},a.getPayUrl=function(c,d){a.decode(c,function(a,e){if(a)return d(a);var f=b.payProviderUrls[e.typ];return f?-1===f.indexOf("{jwt}")?(b.log.error("JWT type",e.typ,"pay URL is formatted incorrectly:",f),d("INVALID_PAY_PROVIDER_URL")):(f=f.replace("{jwt}",c),b.log.info("JWT",e.typ,"resulted in pay URL:",f),void d(null,f)):(b.log.error("JWT type",e.typ,"does not map to any known payment providers"),d("UNEXPECTED_JWT_TYPE"))})}}(),function(){"use strict";function a(a,b,g,h){d.getPayUrl(g,function(d,g){function i(d){function k(c){return"UNKNOWN_MESSAGE_ORIGIN"!==c?(j&&clearInterval(j),e.window.removeEventListener("message",i),b?a.close():e.log.info("payment window should be closed but client is managing it"),c?h(c):void h()):void 0}c.acceptPayMessage(d,f.getUrlOrigin(g),a,k)}if(d)return h(d);a.location=g;var j=setInterval(function(){return!a||a.closed?(clearInterval(j),h("DIALOG_CLOSED_BY_USER")):void 0},500);e.window.addEventListener("message",i)})}var b,c=fxpay.pay={},d=fxpay.getattr("jwt"),e=fxpay.getattr("settings"),f=fxpay.getattr("utils");c.processPayment=function(b,c,d){if(d=f.defaults(d,{managePaymentWindow:!0,paymentWindow:void 0}),!e.mozPay)return d.paymentWindow?(e.log.info("processing payment with web flow"),a(d.paymentWindow,d.managePaymentWindow,b,c)):(e.log.error("Cannot start a web payment without a reference to the payment window"),c("MISSING_PAYMENT_WINDOW"));e.log.info("processing payment with mozPay using jwt",b);var g=e.mozPay([b]);g.onerror=function(){e.log.error("mozPay: received onerror():",this.error.name),e.onBrokenWebRT&&"USER_CANCELLED"===this.error.name?(e.log.warn("webRT: pretending the cancel message is actually a success!"),c()):c(this.error.name)},g.onsuccess=function(){e.log.debug("mozPay: received onsuccess()"),c()}},c.acceptPayMessage=function(a,c,d,f){if(e.log.debug("received",a.data,"from",a.origin),a.origin!==c)return e.log.debug("ignoring message from foreign window at",a.origin),f("UNKNOWN_MESSAGE_ORIGIN");var g=a.data||{};return"unloaded"!==g.status?"ok"===g.status?(e.log.info("received pay success message from window at",a.origin),f()):"failed"===g.status?(e.log.info("received pay fail message with status",g.status,"code",g.errorCode,"from window at",a.origin),f(g.errorCode||"PAY_WINDOW_FAIL_MESSAGE")):(e.log.info("received pay message with unknown status",g.status,"from window at",a.origin),f("UNKNOWN_MESSAGE_STATUS")):(b&&window.clearTimeout(b),void(b=window.setTimeout(function(){return d&&d.closed!==!0?void 0:(e.log.info("Window closed by user."),f("DIALOG_CLOSED_BY_USER"))},300)))}}(),function(){"use strict";function a(a){return{pricePointId:a.price_id,productId:a.guid,name:a.name,smallImageUrl:a.logo_url}}var b=fxpay.products={},c=fxpay.getattr("settings"),d=fxpay.getattr("utils"),e=fxpay.getattr("api").API;b.all=function(b){var f=[],g=new e(c.apiUrlBase),h=d.getSelfOrigin();if(!h)return b("PAY_PLATFORM_UNAVAILABLE",f);h=encodeURIComponent(h);var i;c.fakeProducts?(c.log.warn("about to fetch fake products"),i="/payments/stub-in-app-products/"):(c.log.info("about to fetch real products for app",h),i="/payments/"+h+"/in-app/?active=1"),g.get(i,function(d,e){if(d)return b(d,f);c.log.info("total products fetched:",e.objects.length);for(var g=0;g<e.objects.length;g++){var h=e.objects[g],i=a(h);f.push(i)}b(d,f)})},b.getById=function(b,f,g){g=g||{},"undefined"==typeof g.fetchStubs&&(g.fetchStubs=!1),g.api||(g.api=new e(c.apiUrlBase));var h,i=encodeURIComponent(d.getSelfOrigin());h=g.fetchStubs?"/payments/stub-in-app-products/"+b.toString()+"/":"/payments/"+i+"/in-app/"+b.toString()+"/",c.log.info("fetching product info at URL",h,"fetching stubs?",g.fetchStubs),g.api.get(h,function(d,e){return d?(c.log.error("Error fetching product info",d),f(d,{productId:b})):void f(null,a(e))})}}(),function(){"use strict";function a(a,b){var c=n.appSelf.addReceipt(a);c.onsuccess=function(){n.log.info("item fully purchased and receipt installed"),b(null)},c.onerror=function(){var a=this.error.name;n.log.error("error calling app.addReceipt",a),b(a)}}function b(a,b){var c=n.localStorage.getItem(n.localStorageKey);c=c?JSON.parse(c):[],-1===c.indexOf(a)?c.push(a):n.log.info("not adding receipt",a.substring(0,5),"because it has already been added"),n.localStorage.setItem(n.localStorageKey,JSON.stringify(c)),b(null)}function c(a,b){var c=g(a);return c?void b(null,c):b("INVALID_RECEIPT",{})}function d(a,b,c,d){n.log.debug("receipt data:",b);var e=i(b);n.log.info("about to post to verifier URL",b.verify),e.post(b.verify,a,function(b,e){return c.receiptInfo=e,b?(n.log.error("Error verifying receipt:",b),d(b,c)):(n.log.info("verification result:",e),"ok"===e.status?(n.log.info("validated receipt for",c),d(null,c)):(n.log.error("receipt",a.substring(0,10),"is invalid; service returned:",e.status,e.reason),d("INVALID_RECEIPT",c)))},{contentType:"text/plain"})}function e(a,b){var c={};if(!a.product)return n.log.error("receipt is missing the product field"),b("INVALID_RECEIPT",c);if(!a.product.url)return n.log.error("receipt is missing product.url"),b("INVALID_RECEIPT",c);if(!a.product.storedata)return n.log.error("receipt is missing product.storedata"),b("INVALID_RECEIPT",c);if(a.product.storedataObject=h(a),!a.product.storedataObject)return b("INVALID_RECEIPT",c);var d="test-receipt"===a.typ;if(d&&!n.allowTestReceipts)return n.log.error("cannot restore test receipts when allowTestReceipts is false"),b("TEST_RECEIPT_NOT_ALLOWED",c);var e=a.product.url;if(e&&!e.match(/^(http(s)?|app):\/\/.*$/g)&&(e="app://"+e),c.productUrl=e,!d){var f=o.getSelfOrigin();if(e!==f)return n.log.error("app origin",f,"does not match receipt product URL",e),b("INVALID_RECEIPT",c)}b(null,c)}function f(a,b){for(var c=!1,d=a.verify||"",e=0;e<n.receiptCheckSites.length;e++){var f=n.receiptCheckSites[e];if(0===d.indexOf(f)){c=!0;break}}return c?void b(null,a):(n.log.error("Receipt check URL",a.verify,"is not whitelisted. Valid choices:",n.receiptCheckSites),b("INVALID_RECEIPT",a))}function g(a){var b;if("string"!=typeof a)return n.log.error("unexpected receipt type:",typeof a),null;var c=a.split("~");if(1===c.length)b=c[0];else{if(2!==c.length)return n.log.error("wrong number of tilde separated segments in receipt"),null;b=c[1]}var d=b.split(".");if(3!==d.length)return n.log.error("wrong number of JWT segments in receipt:",d.length),null;b=d[1];try{b=j(b)}catch(e){return n.log.error("error base64 decoding receipt:",e.name,e.message),null}try{b=JSON.parse(b)}catch(e){return n.log.error("error parsing receipt JSON:",e.name,e.message),null}return b}function h(a){if(!a.product)return null;if("string"!=typeof a.product.storedata)return n.log.error("unexpected storedata in receipt:",a.product.storedata),null;var b={};return a.product.storedata.split("&").forEach(function(a){var c=a.split("=");b[c[0]]=decodeURIComponent(c[1])}),b}function i(a){var b=a.iss;return n.log.info("derived base API URL from receipt:",b),new l(b)}function j(a){switch(a=a.replace(/-/g,"+"),a=a.replace(/_/g,"/"),a.length%4){case 0:break;case 1:a+="===";break;case 2:a+="==";break;case 3:a+="=";break;default:throw"Illegal base64url string!"}return atob(a)}var k=fxpay.receipts={},l=fxpay.getattr("api").API,m=fxpay.getattr("products"),n=fxpay.getattr("settings"),o=fxpay.getattr("utils");k.all=function(a){o.getAppSelf(function(b,c){if(b)return a(b);var d=0,e=[];c&&c.receipts&&(d=c.receipts.length,e=Array.prototype.slice.call(c.receipts));var f=0,g=n.localStorage.getItem(n.localStorageKey);if(g){g=JSON.parse(g);for(var h=0;h<g.length;h++)-1===e.indexOf(g[h])?(e.push(g[h]),f++):n.log.info("ignoring dupe receipt fetched from local storage",g[h].substring(0,5))}n.log.info("receipts fetched from mozApps:",d),n.log.info("receipts fetched from localStorage:",f),a(null,e)})},k.add=function(c,d){o.getAppSelf(function(e,f){return e?d(e):f&&f.addReceipt?(n.log.info("adding receipt to device with addReceipt"),a(c,d)):(n.log.info("adding receipt to device with localStorage"),b(c,d))})},k.validateAppReceipt=function(a,b){k.verifyAppData(a,function(c,e,f){return c?b(c,f):void d(a,e,f,function(a,c){if(a)return b(a,c);var d=o.getSelfOrigin();return c.productUrl!==d?(n.log.error("valid receipt but wrong product; our origin:",d,"; receipt product origin:",c.productUrl),b("INVALID_RECEIPT_PRODUCT",c)):void b(null,c)})})},k.validateInAppProductReceipt=function(a,b){k.verifyInAppProductData(a,function(c,e,f){return c?b(c,f):void d(a,e,f,function(a,c){if(a)return b(a,c);var d=i(e);m.getById(c.productId,function(a,d){return c=c||{},Object.keys(d).forEach(function(a){c[a]=d[a]}),a?b(a,c):b(null,c)},{fetchStubs:"test-receipt"===e.typ,api:d})})})},k.verifyData=function(a,b){c(a,function(a,c){return a?b(a,c,{}):void e(c,function(a,d){return a?b(a,c,d):void f(c,function(a){return a?b(a,c,d):void b(null,c,d)})})})},k.verifyAppData=function(a,b){k.verifyData(a,function(a,c,d){return a?b(a,c,d):void o.getAppSelf(function(a,e){if(a)return b(a,c,d);if(!e)return b("PAY_PLATFORM_UNAVAILABLE",c,d);var f,g=e.manifest;return f=g.installs_allowed_from?-1!==g.installs_allowed_from.indexOf("*"):!0,f&&n.log.warn('your paid app manifest specifies installs_allowed_from = ["*"] which means an attacker can provide a spoofed receipt validation service'),f||-1!==g.installs_allowed_from.indexOf(c.iss)?(d.productId=c.product.storedataObject.id,d.productId?void b(null,c,d):(n.log.error("Could not find app productId in storedata:",c.product.storedata),b("INVALID_RECEIPT",c,d))):(n.log.error("receipt issuer",c.iss,"is not an allowed issuer; allowed:",g.installs_allowed_from),b("INVALID_RECEIPT",c,d))})})},k.verifyInAppProductData=function(a,b){k.verifyData(a,function(a,c,d){return a?b(a,c,d):(d.productId=c.product.storedataObject.inapp_id,d.productId?void b(null,c,d):(n.log.error("Could not find in-app productId in storedata:",c.product.storedata),b("INVALID_RECEIPT",c,d)))})},k.checkStoreData=function(a){var b=g(a);return b?h(b):null}}(),function(){"use strict";function a(){}var b=fxpay.adapter={},c=fxpay.getattr("api").API,d=fxpay.getattr("products"),e=fxpay.getattr("receipts"),f=fxpay.getattr("utils");a.prototype.toString=function(){return"<FxInappAdapter at "+(this.api&&this.api.baseUrl)+">"},a.prototype.configure=function(a){this.settings=a,this.api=new c(a.apiUrlBase),a.log.info("configuring Firefox Marketplace In-App adapter")},a.prototype.init=function(a){var b=this.settings;f.getAppSelf(function(c,d){if(c)return a(c);var f=d&&d.addReceipt;return f||b.localStorage?d&&0===b.window.location.href.indexOf("app://")&&!d.manifest.origin?(b.log.error("packaged app did not define an origin so we have no key to look up products"),a("UNDEFINED_APP_ORIGIN")):void e.all(function(c,d){return c?a(c):(d.forEach(function(a){b.log.info("Installed receipt:",a),e.validateInAppProductReceipt(a,b.onrestore)}),b.log.info("Number of receipts installed:",d.length),void a())}):(b.log.error("no way to store receipts on this platform"),a("PAY_PLATFORM_UNAVAILABLE"))})},a.prototype.startTransaction=function(a,b){a=f.defaults(a,{productId:null});var c=this.settings;this.api.post(c.prepareJwtApiUrl,{inapp:a.productId},function(d,e){return d?b(d):(c.log.debug("requested JWT for ",a.productId,"from API; got:",e),b(null,{productJWT:e.webpayJWT,productId:a.productId,productData:e}))})},a.prototype.transactionStatus=function(a,b){var c=this,d=this.settings,e=c.api.url(a.productData.contribStatusURL,{versioned:!1});c.api.get(e,function(f,g){return f?b(f):"complete"!==g.status?"incomplete"===g.status?b(null,!1):(d.log.error("transaction status",g.status,"from",e,"was unexpected"),b("INVALID_TRANSACTION_STATE")):void c._finishTransaction(g,a.productId,function(a,c){return a?b(a):void b(null,!0,c)})})},a.prototype._finishTransaction=function(a,b,c){var f=this.settings;f.log.info("received completed transaction:",a),e.add(a.receipt,function(a){return a?c(a):void d.getById(b,function(a,b){return a?c(a,b):void c(null,b)},{fetchStubs:f.fakeProducts})})},b.FxInappAdapter=a}(),function(){"use strict";function a(b,c,d){d=d||{},d.maxTries=d.maxTries||10,d.pollIntervalMs=d.pollIntervalMs||1e3,d._tries=d._tries||1;var f=e.log;return f.debug("Getting transaction state for",b,"tries=",d._tries),d._tries>d.maxTries?(f.error("Giving up on transaction for",b,"after",d._tries,"tries"),c("TRANSACTION_TIMEOUT")):void e.adapter.transactionStatus(b,function(e,g,h){return e?c(e):g?c(null,h):(f.debug("Re-trying incomplete transaction in",d.pollIntervalMs,"ms"),void window.setTimeout(function(){a(b,c,{maxTries:d.maxTries,pollIntervalMs:d.pollIntervalMs,_tries:d._tries+1})},d.pollIntervalMs))})}var b=window.fxpay,c=fxpay.getattr("pay"),d=fxpay.getattr("receipts"),e=fxpay.getattr("settings"),f=fxpay.getattr("products"),g=fxpay.getattr("utils");b.configure=function(){return e.configure.apply(e,arguments)},b.init=function(a){e.initialize(a),e.adapter.init(function(a){return a?e.onerror(a):void e.oninit()})},b.validateAppReceipt=function(a){e.initialize();var b={};g.getAppSelf(function(c,f){if(c)return a(c,b);if(!f)return a("PAY_PLATFORM_UNAVAILABLE",b);var g=[];d.all(function(c,f){if(c)return a(c,b);f.forEach(function(a){var b=d.checkStoreData(a);return b?b.inapp_id?void e.log.info("ignoring in-app receipt with storedata",b):void g.push(a):void e.log.info("ignoring receipt with missing or unparsable storedata")}),e.log.info("app receipts found:",g.length);var h;return 0===g.length?a("APP_RECEIPT_MISSING",b):1===g.length?(h=g[0],e.log.info("Installed receipt:",h),d.validateAppReceipt(h,function(b,c){e.log.info("got verification result for",c),a(b,c)})):(e.log.error("multiple app receipts were found which is not yet supported"),a("NOT_IMPLEMENTED_ERROR",b))})})},b.purchase=function(b,d,f){function h(){f.paymentWindow&&!f.paymentWindow.closed&&(f.managePaymentWindow?f.paymentWindow.close():e.log.info("payment window should be closed but client is managing it"))}e.initialize(),f=g.defaults(f,{maxTries:void 0,managePaymentWindow:void 0,paymentWindow:void 0,pollIntervalMs:void 0}),"undefined"==typeof f.managePaymentWindow&&(f.managePaymentWindow=!f.paymentWindow);var i={productId:b};d||(d=function(a,b){if(a)throw a;e.log.info("product",b.productId,"purchased")}),e.log.debug("starting purchase for product",b),e.mozPay||(f.paymentWindow?(e.log.info("web flow will use client provided payment window"),g.reCenterWindow(f.paymentWindow,e.winWidth,e.winHeight)):f.paymentWindow=g.openWindow()),e.adapter.startTransaction({productId:b},function(b,e){return b?(h(),d(b,i)):void c.processPayment(e.productJWT,function(b){return b?(h(),d(b,i)):void a(e,function(a,b){d(a,b||i)},{maxTries:f.maxTries,pollIntervalMs:f.pollIntervalMs})},{managePaymentWindow:f.managePaymentWindow,paymentWindow:f.paymentWindow})})},b.getProducts=function(){f.all.apply(f,arguments)}}();
//# sourceMappingURL=fxpay.min.js.map